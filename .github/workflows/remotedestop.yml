name: REMOTE DESKTOP

on:
  workflow_dispatch:
    inputs:
      code:
        description: "ğŸ”‘ Enter 12-Digit Access Code"
        required: true
        type: string

env:
  BASE_DIR: "C:\RemoteDesktop"
  SESSION_DURATION: 43200
  RETRY_ATTEMPTS: 3

jobs:
  remote_connection:
    name: ğŸ–¥ï¸ REMOTE DESKTOP CONSOLE
    runs-on: windows-latest
    timeout-minutes: ${{ env.SESSION_DURATION }}

    steps:
    - name: ğŸ”’ System Configuration
      shell: powershell
      run: |
        Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        Write-Host "ğŸ›¡ï¸  DISABLING SYSTEM PROTECTIONS"
        Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled False
        Set-MpPreference -DisableRealtimeMonitoring $true
        Write-Host "âœ… System protections disabled successfully"
        Write-Host ""

    - name: ğŸ“¦ Software Installation
      shell: powershell
      run: |
        Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        Write-Host "ğŸ“¥ INSTALLING REQUIRED COMPONENTS"
        Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        
        function Install-Software {
            param ($package)
            $attempt = 1
            while ($attempt -le ${{ env.RETRY_ATTEMPTS }}) {
                try {
                    Write-Host "âŸ³ Attempt $attempt : $package"
                    choco install $package -y --force --ignore-checksums
                    Write-Host "âœ” $package installed successfully"
                    return
                } catch {
                    Write-Host "âš  Attempt $attempt failed"
                    $attempt++
                    if ($attempt -le ${{ env.RETRY_ATTEMPTS }}) {
                        Start-Sleep -Seconds 10
                    }
                }
            }
            Write-Host "âŒ Failed to install $package"
        }

        Install-Software "chrome-remote-desktop-host"
        Install-Software "googlechrome"
        Write-Host ""

    - name: ğŸš€ Launching Services
      shell: powershell
      run: |
        Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        Write-Host "ğŸš€ INITIALIZING REMOTE SERVICES"
        Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        
        $servicePath = @(
            "${Env:PROGRAMFILES(X86)}\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe",
            "${Env:PROGRAMFILES}\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe"
        ) | Where-Object { Test-Path $_ } | Select-Object -First 1

        if ($servicePath) {
            Start-Process $servicePath -WindowStyle Hidden
            Write-Host "âœ” Remote desktop service started"
        } else {
            Write-Host "âŒ Service executable not found"
        }
        Write-Host ""

    - name: ğŸ”— Establishing Connection
      shell: powershell
      run: |
        Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        Write-Host "ğŸ”— CONNECTING TO REMOTE SESSION"
        Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        
        if (${{ inputs.code }} -match '^\d{12}$') {
            Start-Process "chrome-remote-desktop-host" -ArgumentList "--code=${{ inputs.code }} --pin=123456" -WindowStyle Hidden
            Write-Host "âœ” Connection established with code: ${{ inputs.code }}"
        } else {
            Write-Host "âŒ Invalid code format - must be 12 digits"
        }
        Write-Host ""

    - name: ğŸ•’ Active Session Monitor
      shell: powershell
      run: |
        Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        Write-Host "ğŸ”„ SESSION ACTIVE - MONITORING CONNECTION"
        Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        Write-Host "ğŸ–¥ï¸  Remote access is now available"
        Write-Host ""
        
        $startTime = Get-Date
        while ($true) {
            $elapsed = (Get-Date) - $startTime
            $days = $elapsed.Days
            $hours = $elapsed.Hours
            $minutes = $elapsed.Minutes
            
            Write-Host "ğŸŸ¢ CONNECTED | Uptime: ${days}d ${hours}h ${minutes}m"
            Start-Sleep -Seconds 60
        }

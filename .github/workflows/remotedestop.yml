name: ğŸ® FREE FIRE RIPPER

on:
  workflow_dispatch:
    inputs:
      code:
        description: "ğŸ“‹ Paste Chrome Remote Desktop Code"
        required: true

jobs:
  build:
    name: "ğŸ”¥ Free Fire Ripper Lab Running"
    runs-on: windows-latest
    timeout-minutes: 43800  # 30 days

    steps:
    # ğŸ”’ Disable Firewall
    - name: "ğŸ›¡ï¸ Disable Windows Firewall"
      run: |
        try {
          Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled False
          Write-Host "âœ… Firewall disabled successfully!"
        } catch {
          Write-Host "âš ï¸ Failed to disable firewall. Continuing anyway..."
        }

    # ğŸ“¦ Install Required Packages
    - name: "ğŸ“¥ Install Chrome Remote Desktop & Chrome"
      run: |
        function Install-PackageWithRetry {
            param ([string]$packageName)
            $maxRetries = 3
            $retryCount = 0
            while ($retryCount -lt $maxRetries) {
                try {
                    choco install $packageName -y --ignore-checksums
                    Write-Host "âœ… $packageName installed successfully!"
                    return
                } catch {
                    Write-Host "ğŸ”„ Retrying $packageName install ($($retryCount+1)/$maxRetries)"
                    Start-Sleep -Seconds 10
                    $retryCount++
                }
            }
            Write-Host "âŒ Failed to install $packageName after $maxRetries attempts"
        }
        
        # Install packages
        Install-PackageWithRetry -packageName "chrome-remote-desktop-host"
        Install-PackageWithRetry -packageName "googlechrome"
        Install-PackageWithRetry -packageName "7zip"

    # â¬‡ï¸ Download Free Fire Ripper Package
    - name: "ğŸ“¦ Download Free Fire Tools"
      continue-on-error: true
      run: |
        $downloadPath = "C:\Users\$Env:USERNAME\Documents\ffripper.zip"
        Write-Host "ğŸ”½ Downloading Free Fire Ripper package..."
        try {
          Invoke-WebRequest -Uri "https://drive.usercontent.google.com/download?id=11EUFz6hufNT1g56-CmOJw9_KxMERZxhe&export=download" -OutFile $downloadPath
          Write-Host "âœ… Download completed!"
        } catch {
          Write-Host "âŒ Download failed: $_"
          exit 1
        }

    # ğŸ“‚ Extract Files
    - name: "ğŸ—‚ï¸ Extract Free Fire Tools"
      continue-on-error: true
      run: |
        cd C:\Users\$Env:USERNAME\Documents
        Write-Host "ğŸ” Extracting files..."
        try {
          7z x ffripper.zip -y -o"C:\Users\$Env:USERNAME\Documents\FreeFireRipper"
          Write-Host "âœ… Extraction completed!"
        } catch {
          Write-Host "âŒ Extraction failed: $_"
        }

    # ğŸ–¥ï¸ Setup Chrome Remote Desktop
    - name: "ğŸš€ Start Chrome Remote Desktop"
      run: |
        function Start-RemoteDesktop {
          $paths = @(
            "${Env:PROGRAMFILES(X86)}\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe",
            "${Env:PROGRAMFILES}\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe"
          )
          foreach ($path in $paths) {
              if (Test-Path $path) {
                Write-Host "ğŸ”Œ Starting Chrome Remote Desktop from $path"
                & $path
                return
              }
          }
          Write-Host "âŒ Chrome Remote Desktop executable not found!"
        }
        Start-RemoteDesktop

    # ğŸ”— Create Desktop Shortcuts
    - name: "ğŸ“Œ Create Desktop Shortcuts"
      run: |
        Write-Host "ğŸ“ Creating shortcuts..."
        New-Item -ItemType SymbolicLink -Target "C:\Users\$Env:USERNAME\Documents\FenixGaga\Engine\ProjectTitan.exe" -Path "C:\Users\$Env:USERNAME\Desktop\Free Fire.lnk"
        New-Item -ItemType SymbolicLink -Target "C:\Users\$Env:USERNAME\Documents\ninjaripper\x86\NinjaRipper.exe" -Path "C:\Users\$Env:USERNAME\Desktop\Ninjaripper.lnk"
        New-Item -ItemType SymbolicLink -Target "C:\Users\$Env:USERNAME\Documents\noesis\Noesis64.exe" -Path "C:\Users\$Env:USERNAME\Desktop\Noesis.lnk"
        Write-Host "âœ… Shortcuts created successfully!"

    # ğŸ”„ Establish Connection
    - name: "ğŸ”— Connect Remote Desktop"
      continue-on-error: true
      run: |
        Write-Host "ğŸ–¥ï¸ Connecting to VM with Remote Desktop..."
        ${{ inputs.code }} --pin=123456
        Write-Host "âœ… Connection established!"

    # â³ Keep Session Alive
    - name: "â³ Maintain Connection (30 days)"
      run: |
        Write-Host "â° Session will remain active for 30 days..."
        $i = 43800  # 30 days in minutes
        do {
            Write-Host "â±ï¸ Time remaining: $i minutes"
            Start-Sleep 60
            $i--
        } while ($i -gt 0)
        Write-Host "âŒ› Session timeout reached"
